<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escuela Proa La Falda - Novedades</title>
  <link rel="icon" href="logo.ico" type="image/x-icon">
  <link rel="stylesheet" href="styles.css"> <!-- Enlace a tu archivo CSS -->
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo de la Escuela">
    <h1>Escuela Proa La Falda</h1>
    <p>Formando a los líderes del mañana</p>
  </header>

  <div class="container">
    <h2 class="section-title">Novedades</h2>
    <!-- Formulario para enviar comentarios -->
    <div class="comment-form">
      <h3>Deja tu comentario:</h3>
      <input type="text" id="nombre" placeholder="Tu nombre" required>
      <textarea id="comentario" placeholder="Escribe tu comentario" required></textarea>
      <button onclick="enviarComentario()">Enviar comentario</button>
    </div>

    <!-- Lista de comentarios -->
    <div class="comments-list" id="commentsList">
      <h3>Comentarios:</h3>
      <!-- Los comentarios se cargarán aquí -->
    </div>
  </div>

  <script>
    // Función para cargar los comentarios
    function cargarComentarios() {
      fetch('/.netlify/functions/comments') // Llamada a la función de Netlify
        .then(response => response.json())
        .then(comments => {
          const commentsList = document.getElementById('commentsList');
          commentsList.innerHTML = ''; // Limpiar la lista actual

          // Agregar cada comentario a la página
          comments.forEach(comment => {
            const commentElement = document.createElement('div');
            commentElement.classList.add('comment');
            commentElement.innerHTML = `
              <p><strong>${comment.nombre}:</strong> ${comment.texto}</p>
            `;
            commentsList.appendChild(commentElement);
          });
        })
        .catch(error => {
          console.error('Error al cargar los comentarios:', error);
        });
    }

    // Función para enviar un nuevo comentario
    function enviarComentario() {
      const nombre = document.getElementById('nombre').value;
      const comentario = document.getElementById('comentario').value;

      if (nombre && comentario) {
        const newComment = {
          nombre: nombre,
          texto: comentario,
        };

        // Enviar el comentario a la función de Netlify
        fetch('/.netlify/functions/comments', {
          method: 'POST',
          body: JSON.stringify(newComment),
          headers: {
            'Content-Type': 'application/json',
          },
        })
        .then(response => response.json())
        .then(data => {
          alert('Comentario enviado con éxito');
          cargarComentarios(); // Recargar los comentarios
        })
        .catch(error => {
          console.error('Error al enviar el comentario:', error);
        });
      } else {
        alert('Por favor, completa todos los campos.');
      }
    }

    // Cargar los comentarios al inicio
    cargarComentarios();
  </script>
</body>
</html>
