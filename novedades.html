<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escuela Proa La Falda - Novedades</title>
  <link rel="icon" href="logo.ico" type="image/x-icon">
  <style>
    /* (Aquí va el estilo de tu página) */
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo de la Escuela">
    <h1>Escuela Proa La Falda</h1>
    <p>Formando a los líderes del mañana</p>
  </header>

  <div class="container">
    <h2 class="section-title">Novedades</h2>

    <!-- Formulario de publicación -->
    <section class="form-publicacion" id="formPublicacion" style="display:block;">
      <h2>Publicar Novedad</h2>
      <textarea id="mensaje" placeholder="Escribe tu mensaje aquí..."></textarea>
      <button onclick="publicarNovedad()">Publicar</button>
    </section>

    <!-- Novedades publicadas -->
    <section class="novedades-container">
      <h2>Mensajes</h2>
      <div id="listaNovedades">
        <!-- Las novedades se mostrarán aquí -->
      </div>
    </section>
  </div>

  <script>
    // Función para publicar una novedad
    function publicarNovedad() {
      const mensaje = document.getElementById('mensaje').value;
      if (mensaje.trim() !== "") {
        // Agregar un ";" al principio del mensaje
        const mensajeConSeparador = `; ${mensaje}`;

        // Llamar al backend para actualizar el archivo en GitHub
        actualizarNovedadesGitHub(mensajeConSeparador);

        // Limpiar el campo de mensaje
        document.getElementById('mensaje').value = "";
      } else {
        alert('Escribe un mensaje antes de publicar');
      }
    }

    // Función para llamar al backend y actualizar el archivo en GitHub
    function actualizarNovedadesGitHub(mensaje) {
      const tokenGitHub = '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';  // Coloca tu token de acceso personal de GitHub
      const repo = 'cproa/cproa.github.io';        // Cambia por tu usuario y repositorio
      const archivo = 'novedades.txt';           // El archivo que quieres actualizar

      // Primero, obtienes el contenido actual del archivo
      fetch(`https://api.github.com/repos/${repo}/contents/${archivo}`, {
        method: 'GET',
        headers: {
          'Authorization': `token ${tokenGitHub}`
        }
      })
      .then(response => response.json())
      .then(data => {
        const contenidoActual = atob(data.content);  // Decodificar el contenido del archivo
        const nuevoContenido = contenidoActual + mensaje;  // Añadir el nuevo mensaje

        // Realizar un commit para actualizar el archivo
        fetch(`https://api.github.com/repos/${repo}/contents/${archivo}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${tokenGitHub}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: "Actualizar novedades",
            content: btoa(nuevoContenido),  // Volver a codificar el contenido
            sha: data.sha  // Obtener la SHA del archivo para el commit
          })
        })
        .then(response => response.json())
        .then(data => {
          console.log('Archivo actualizado:', data);
          // Recargar las novedades o hacer algo después de actualizar el archivo
          cargarNovedades();
        })
        .catch(error => console.error('Error al actualizar el archivo en GitHub:', error));
      })
      .catch(error => console.error('Error al obtener el archivo de GitHub:', error));
    }

    // Función para cargar las novedades y mostrarlas en la página
    function cargarNovedades() {
      // Aquí deberías tener un método para cargar las novedades actualizadas
      console.log("Cargando novedades...");
    }
  </script>
</body>
</html>
